<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stichting Zuidendijk</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div id="splash">
  <img src="/images/logo.png" alt="Zuidendijk logo">
</div>
<header>
  <h1>Stichting Zuidendijk Nieuws</h1>
  <p>Buurtnieuws uit het groene hart van de Dordtse dijk</p>
</header>

<main id="news-container">
  <p>Loading newsâ€¦</p>
</main>

<script>
// Splash screen logic
if (localStorage.getItem("visitedZuidendijk") === "true") {
  const splash = document.createElement("style");
  splash.textContent = "#splash { display: none !important; }";
  document.head.appendChild(splash);
} else {
  // localStorage.setItem("visitedZuidendijk", "true");
}

// List your news files here in date-descending order
const newsFiles = [
  "2025-07-25-planting-day.md"
];

// Simple markdown parser with basic support for # headers and images
function parseMarkdown(md, dateString) {
  const lines = md.split("\n");
  const container = document.createElement("div");
  container.className = "news-post";

  // Add date box
  const dateBox = document.createElement("div");
  dateBox.className = "news-date";
  const dateObj = new Date(dateString);
  const formattedDate = dateObj.toLocaleDateString("nl-NL", {
    year: "numeric",
    month: "long",
    day: "numeric"
  });
  dateBox.textContent = formattedDate;
  container.appendChild(dateBox);

  lines.forEach(line => {
    line = line.trim();

    // Header line (# Header)
    if(line.startsWith("# ")) {
      const h = document.createElement("h2");
      h.textContent = line.substring(2).trim();
      container.appendChild(h);
      return;
    }

    // Image line !(img)[path]
    const imgMatch = line.match(/^!\(img\)\[(.+)\]$/);
    if(imgMatch) {
      const img = document.createElement("img");
      img.src = imgMatch[1];
      img.alt = "News image";
      img.className = "news-image";
      container.appendChild(img);
      return;
    }

    // Normal paragraph
    if(line.length > 0) {
      const p = document.createElement("p");
      p.textContent = line;
      container.appendChild(p);
    }
  });

  return container;
}

async function loadNews() {
  const container = document.getElementById("news-container");
  container.innerHTML = ""; // clear loading text

  for(const file of newsFiles) {
    try {
      const response = await fetch(`news/${file}`);
      if(!response.ok) throw new Error(`Failed to fetch ${file}`);

      const text = await response.text();
      const datePart = file.split("-").slice(0, 3).join("-"); // YYYY-MM-DD
      const post = parseMarkdown(text, datePart);
      container.appendChild(post);
    } catch(e) {
      console.error(e);
      const errorMsg = document.createElement("p");
      errorMsg.textContent = `Error loading ${file}`;
      container.appendChild(errorMsg);
    }
  }
}

loadNews();
</script>

</body>
</html>
